data,H=NA) # baseline variance constant
ssm_y_init_fit=fitSSM(ssm_y_init, inits =rep(0,n_variables+1), method = "BFGS") # n_variables + one NA in H
ssm_y_init_out=KFS(ssm_y_init_fit$model)
plot.KFS(ssm_y_init_out,range=30:708)
ssm_y_init_out$model$Q; ssm_y_init_out$model$H
######################## Part II: statespace model without imputation ########################
formula=" negative_total ~ negative_total_1 + keycontacts_call_totaldegree_binary + keycontacts_call_totaldegree_binary_1 + keycontacts_text_reciprocity_degree_binary + keycontacts_text_reciprocity_degree_binary_1+ logit_TAM_phone_1"
all_var=unlist(strsplit(gsub(" ","",formula),"\\+|\\~"))
outcome_var=strsplit(gsub(" ","",formula),"\\~")[[1]][1]
formula_var=all_var[!(all_var %in% c(outcome_var,"intercept"))]
data_ss_ignore_y=data[-1,all_var]
data_ss_ignore_y[rowSums(is.na(data_ss_ignore_y))!=0,outcome_var]=NA
for(l in formula_var){
data_ss_ignore_y[is.na(data_ss_ignore_y[,l]),l]=mean(data_ss_ignore_y[,l],na.rm=T)
}
ss_param_y=list(inits=c(log(0.2),log(2.5)),m0=ssm_y_init$att[708,],C0=diag(rep(10^3),7),
AR1_coeffi=NULL,rw_coeffi=c("intercept"),v_cp_param=NULL,
w_cp_param=list(list(variable="keycontacts_text_reciprocity_degree_binary",segments=3,changepoints=c(560,640),fixed_cpts=F),
list(variable="keycontacts_text_reciprocity_degree_binary_1",segments=2,changepoints=c(460),fixed_cpts=F)))
ssm_y=run.SSM(data_ss=data_ss_ignore_y,formula=formula,ss_param=ss_param_y,max_iteration=100,
cpt_learning_param=list(cpt_method="mean",burnin=1/10,mergeband=20,convergence_cri=10),
cpt_merge_option="separate",dlm_cpt_learning_option="filter",
bandwidth=5,cpt_V =1,printFlag=T)
plot.dlm(ssm_y$out_filter,benchmark = rep(0,7),option="filtered_state",range=30:708)
ssm_y_all=cbind(round(ssm_y$result,digits=3),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=3),",",
round(ssm_y$result$Estimate+qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=3),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=3),",",
round(ssm_y$result$Estimate+qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=3),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=3),",",
round(ssm_y$result$Estimate+qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=3),")",sep=""))
digits=4
ssm_y_all=cbind(round(ssm_y$result,digits=digits),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""))
rownames(ssm_y_all)=rownames(ssm_y$result)
colnames(ssm_y_all)=c("Estimate","Std.Error","99% CI","95% CI", "90% CI")
ssm_y_all
digits=2
ssm_y_all=cbind(round(ssm_y$result,digits=digits),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""))
rownames(ssm_y_all)=rownames(ssm_y$result)
colnames(ssm_y_all)=c("Estimate","Std.Error","99% CI","95% CI", "90% CI")
ssm_y_all
qnorm(0.975)
qnorm(0.95)
# random walk intercept
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,1],type="l",ylab=expression(paste(mu["0,t"]," (intercept)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-5,5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# 3 period autocorrelation
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pa,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,xaxt="n")
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,xaxt="n")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("topright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
address = "/Users/xiaoxuancai/Dropbox/MHealthPsychSummerProject2020/Xiaoxuan_Cai/[Paper 1] Causal estimands for time series data/Graphs"
address = "/Users/xiaoxuancai/Dropbox/MHealthPsychSummerProject2020/Xiaoxuan_Cai/[Paper 1] Causal estimands for time series data/Graphs/"
paste(address,"ssmc_intercept.pdf")
paste(address,"ssmc_intercept.pdf",sep="")
# random walk intercept
pdf(file=paste(address,"ssmc_intercept.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,1],type="l",ylab=expression(paste(mu["0,t"]," (intercept)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-5,5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,xaxt="n")
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("topright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# 3 period autocorrelation
pdf(file=paste(address,"ssmc_rho.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,xaxt="n")
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("topright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_c$out_filter$m[,3],type="l",ylab=expression(paste(mu["1,t"]," (degree of calls)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,3]+1.65*sd,rev(ssm_c$out_filter$m[,3]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# time-invariant coeffi for degree of calls with keycontacts
pdf(file=paste(address,"ssmc_calls.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,3],type="l",ylab=expression(paste(mu["1,t"]," (degree of calls)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,3]+1.65*sd,rev(ssm_c$out_filter$m[,3]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_c$out_filter$m[,1],type="l",ylab=expression(paste(mu["0,t"]," (intercept)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-5,5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,xaxt="n")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2)
# 3 period autocorrelation
pdf(file=paste(address,"ssmc_rho.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2)
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("topright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_c$out_filter$m[,3],type="l",ylab=expression(paste(mu["1,t"]," (degree of calls)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,3]+1.65*sd,rev(ssm_c$out_filter$m[,3]-1.65*sd)),col="grey90",border="grey")
# time-invariant coeffi for degree of calls with keycontacts
pdf(file=paste(address,"ssmc_calls.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,3],type="l",ylab=expression(paste(mu["1,t"]," (degree of calls)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,3]+1.65*sd,rev(ssm_c$out_filter$m[,3]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
a=cpt.mean(ssm_c$out_filter$m[,4],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,4],type="l",ylab=expression(paste(mu["2,t"]," (degree of texts)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2, ylim=c(-5,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,4]+1.65*sd,rev(ssm_c$out_filter$m[,4]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,4],type="l")
lines(c(1:708)[c(1,cpts(a)[2])],rep(param.est(a)$mean[2],2),col="red")
lines(c(1:708)[c(cpts(a)[2]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
a=cpt.mean(ssm_c$out_filter$m[,4],penalty="Manual",Q=3,method="BinSeg")
a
plot(1:708,ssm_c$out_filter$m[,4],type="l",ylab=expression(paste(mu["2,t"]," (degree of texts)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2, ylim=c(-5,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,4]+1.65*sd,rev(ssm_c$out_filter$m[,4]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,4],type="l")
cpts(a)[2]
param.est(a)$mean
a=cpt.mean(ssm_c$out_filter$m[,4],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,4],type="l",ylab=expression(paste(mu["2,t"]," (degree of texts)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2, ylim=c(-5,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,4]+1.65*sd,rev(ssm_c$out_filter$m[,4]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,4],type="l")
param.est(a)$mean
lines(c(1:708)[c(1,cpts(a)[2])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# periodic-stable coeff for degree of texts with keycontacts
pdf(file=paste(address,"ssmc_texts.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_c$out_filter$m[,4],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,4],type="l",ylab=expression(paste(mu["2,t"]," (degree of texts)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2, ylim=c(-5,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,4]+1.65*sd,rev(ssm_c$out_filter$m[,4]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,4],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_c$out_filter$m[,5],type="l",ylab=expression(paste(mu["3,t"]," (negative mood)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-0.7,0.5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[5])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,5]+1.65*sd,rev(ssm_c$out_filter$m[,5]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,5],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# time-invariant coeffi for negative mood
pdf(file=paste(address,"ssmc_negative.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,5],type="l",ylab=expression(paste(mu["3,t"]," (negative mood)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-0.7,0.5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[5])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,5]+1.65*sd,rev(ssm_c$out_filter$m[,5]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,5],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
ssm_y_all
digits=3
ssm_y_all=cbind(round(ssm_y$result,digits=digits),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.01/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.05/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""),
paste("(",round(ssm_y$result$Estimate-qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),",",
round(ssm_y$result$Estimate+qnorm(1-0.1/2)*ssm_y$result$Std.Error,digits=digits),")",sep=""))
rownames(ssm_y_all)=rownames(ssm_y$result)
colnames(ssm_y_all)=c("Estimate","Std.Error","99% CI","95% CI", "90% CI")
ssm_y_all
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,1],type="l",ylab=expression(paste(beta["0,t"]," (intercept)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-3,8))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,1]+1.65*sd,rev(ssm_y$out_filter$m[,1]-1.65*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
address = "/Users/xiaoxuancai/Dropbox/MHealthPsychSummerProject2020/Xiaoxuan_Cai/[Paper 1] Causal estimands for time series data/Graphs/"
# random walk intercept
pdf(file=paste(address,"ssmc_intercept.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,1],type="l",ylab=expression(paste(mu["0,t"]," (intercept)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-5,5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# 3 period autocorrelation
pdf(file=paste(address,"ssmc_rho.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_c$out_filter$m[,2],penalty="Manual",Q=4,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,2],type="l",ylab=expression(paste(rho["pm,t"]," (auto-correlation)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2)
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,2],type="l")
lines(c(1:708)[c(1,cpts(a)[3])],rep(param.est(a)$mean[3],2),col="red")
lines(c(1:708)[c(cpts(a)[3]+1,cpts(a)[4])],rep(param.est(a)$mean[4],2),col="red")
lines(c(1:708)[c(cpts(a)[4]+1,708)],rep(param.est(a)$mean[5],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("topright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# time-invariant coeffi for degree of calls with keycontacts
pdf(file=paste(address,"ssmc_calls.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,3],type="l",ylab=expression(paste(mu["1,t"]," (degree of calls)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,3]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,3]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# periodic-stable coeff for degree of texts with keycontacts
pdf(file=paste(address,"ssmc_texts.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_c$out_filter$m[,4],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_c$out_filter$m[,4],type="l",ylab=expression(paste(mu["2,t"]," (degree of texts)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2, ylim=c(-5,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,4]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,4]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,4],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# time-invariant coeffi for negative mood
pdf(file=paste(address,"ssmc_negative.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_c$out_filter$m[,5],type="l",ylab=expression(paste(mu["3,t"]," (negative mood)")),xlab="Time (days)",bty="n",cex.lab=2,cex.axis=2,ylim=c(-0.7,0.5))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_c$out_filter$U.C[[i]],ssm_c$out_filter$D.C[i,]))[5])}))
polygon(c(1:708,rev(1:708)),c(ssm_c$out_filter$m[,5]+qnorm(0.975)*sd,rev(ssm_c$out_filter$m[,5]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_c$out_filter$m[,5],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,1],type="l",ylab=expression(paste(beta["0,t"]," (intercept)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-3,8))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
# random walk intercept
pdf(file=paste(address,"ssmy_intercept.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,1],type="l",ylab=expression(paste(beta["0,t"]," (intercept)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-3,8))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[1])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,1]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,1]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,1],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_y$out_filter$m[,2],type="l",ylab=expression(paste(rho[t]," (auto-correlation)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(0.0,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,2],type="l")
abline(h=0,col="black",lty=3,lwd=2)
# time-invariant autocorrelation
pdf(file=paste(address,"ssmy_rho.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,2],type="l",ylab=expression(paste(rho[t]," (auto-correlation)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(0.0,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[2])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,2]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,2]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,2],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
plot(1:708,ssm_y$out_filter$m[,3],type="l",ylab=expression(paste(beta["11,t"]," (degree of calls)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,3]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,3]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# time-invariant coeffi for degree of calls with keycontacts
pdf(file=paste(address,"ssmy_calls.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,3],type="l",ylab=expression(paste(beta["11,t"]," (degree of calls)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[3])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,3]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,3]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,3],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# time-invariant coeffi for degree of calls yesterday with keycontacts
pdf(file=paste(address,"ssmy_calls2.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,4],type="l",ylab=expression(paste(beta["12,t"]," (degree of calls previous day)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[4])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,4]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,4]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,4],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# periodic-stable coeff for degree of texts
a=cpt.mean(ssm_y$out_filter$m[,5],penalty="Manual",Q=2,method="BinSeg")
dev.off()
a=cpt.mean(ssm_y$out_filter$m[,5],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_y$out_filter$m[,5],type="l",ylab=expression(paste(beta["21,t"]," (degree of texts)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-4,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[5])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,5]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,5]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,5],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,cpts(a)[2])],rep(param.est(a)$mean[2],2),col="red")
lines(c(1:708)[c(cpts(a)[2]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
# periodic-stable coeff for degree of texts
pdf(file=paste(address,"ssmy_texts.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_y$out_filter$m[,5],penalty="Manual",Q=2,method="BinSeg")
plot(1:708,ssm_y$out_filter$m[,5],type="l",ylab=expression(paste(beta["21,t"]," (degree of texts)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-4,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[5])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,5]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,5]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,5],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,cpts(a)[2])],rep(param.est(a)$mean[2],2),col="red")
lines(c(1:708)[c(cpts(a)[2]+1,708)],rep(param.est(a)$mean[3],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_y$out_filter$m[,6],penalty="Manual",Q=1,method="BinSeg")
plot(1:708,ssm_y$out_filter$m[,6],type="l",ylab=expression(paste(beta["22,t"]," (degree of outgoing texts previous day)")),xlab="Time (days)" ,bty="n",cex.lab=1.5,cex.axis=2, ylim=c(-3,2))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[6])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,6]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,6]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,6],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,708)],rep(param.est(a)$mean[2],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
# time-invariant coeffi for degree of texts yesterday
pdf(file=paste(address,"ssmy_texts2.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
a=cpt.mean(ssm_y$out_filter$m[,6],penalty="Manual",Q=1,method="BinSeg")
plot(1:708,ssm_y$out_filter$m[,6],type="l",ylab=expression(paste(beta["22,t"]," (degree of outgoing texts previous day)")),xlab="Time (days)" ,bty="n",cex.lab=1.5,cex.axis=2, ylim=c(-3,2))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[6])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,6]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,6]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,6],type="l")
lines(c(1:708)[c(1,cpts(a)[1])],rep(param.est(a)$mean[1],2),col="red")
lines(c(1:708)[c(cpts(a)[1]+1,708)],rep(param.est(a)$mean[2],2),col="red")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
# time-invariant coeffi for physical activity
pdf(file=paste(address,"ssmy_pa.pdf",sep=""),width = 12, height = 6)
par(mar = c(5, 5, .5, .5))
plot(1:708,ssm_y$out_filter$m[,7],type="l",ylab=expression(paste(beta["PA,t"]," (daily physical activity)")),xlab="Time (days)" ,bty="n",cex.lab=2,cex.axis=2, ylim=c(-1,1))
sd=unlist(lapply(1:708,function(i){sqrt(diag(dlmSvd2var(ssm_y$out_filter$U.C[[i]],ssm_y$out_filter$D.C[i,]))[7])}))
polygon(c(1:708,rev(1:708)),c(ssm_y$out_filter$m[,7]+qnorm(0.975)*sd,rev(ssm_y$out_filter$m[,7]-qnorm(0.975)*sd)),col="grey90",border="grey")
points(1:708,ssm_y$out_filter$m[,7],type="l")
abline(h=0,col="black",lty=3,lwd=2)
legend("bottomright",legend=c("estimate", "95% CI"),
pch = c(NA,15), lty=c(1,NA), col=c("black","grey"),
bty = "n", # remove the bounder of the legend
lwd = c(1,NA), pt.bg = c(NA,"grey90"),cex=2)
dev.off()
